# GitHub Actions Workflow 的名称
name: Build Xlink Windows Client (Debug)

on:
  push:
    branches: [ "main" ]
  release:
    types: [published]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'
          cache: true 

      - name: Install Wails CLI
        run: go install github.com/wailsapp/wails/v2/cmd/wails@latest

      # ⚠️【关键修改】使用 -debug 开启调试模式，允许右键审查元素
      # 移除了 -ldflags "-H windowsgui" 以便在开发阶段排错
      - name: Build Wails application
        run: wails build -platform windows/amd64 -debug

      - name: Prepare packaging resources
        run: |
          if (-not (Test-Path release)) { mkdir release }
          Copy-Item build/bin/xlink-client.exe -Destination release/
          
          # 注意：请确保您后续填入真实的内核下载链接，否则程序只有界面无法连接
          echo "Downloading runtime resources (Skipped)..."
          # iwr ... (下载命令略)

      - name: Create ZIP archive
        run: |
          Compress-Archive -Path release\* -DestinationPath xlink-client-windows-amd64-debug.zip

      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: xlink-client-windows-amd64-debug
          path: xlink-client-windows-amd64-debug.zip
